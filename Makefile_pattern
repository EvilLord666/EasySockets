# Ushakov Michael Makefile pattern v 1.1
# ********************************1. VARIABLES SECTION*********************************
# 1 C/C++ Compiler
CXX = g++
# 2. Compiler Keys (man gcc)
CXXFLAGS = -Wall -g
# 3. Linking libraries
LIBPATH -L. -L..
LIBS = -lrt -lpthread
# 4. DEFINITIONS (PREPROCESSOR DEFINE)
#DEFS=
# 5. INCLUDES PATH
INCLUDES = -I./subpath1/ -I./subpath2/
# 6. SOURCES FILES
# Directories with sources
DIRS = . subpath1 subpath2 subpath2/subsubpath3
SRCFILESDIRS := $(addprefix / , $(DIRS))
# Obtaining source files list
CSRCFILES := $(foreach sdir, $(SRCFILESDIRS), $(wildcard $(sdir)/*.c))
CPPSRCFILES = $(foreach sdir, $(SRCFILESDIRS), $(wildcard $(sdir)/*.cpp))
# 7. OBJECTS FILE NAME
OBJFILES = $(CSRCFILES:.c=.o) $(CPPSRCFILES:.cpp=.o)
# $(SRCFILES:.cpp=.o)
# 8. EXECUTABLE TARGET OR RESULTING OBJ-FILE
EXEC_TARGET = example
# *****************************END OF VARIABLES SECTION********************************
# ****************************2. BUILDING TARGETS SECTION******************************
# BY DEFAULT BUILDS first target (make without parameters)
# TO BUILD SPECIFIC TARGETS TYPE make "target name" (without quotation marks)
# each target MUST BE WRITTEN AS: Dependencies Tab(press tab key) Command
# MAKEFILE SPECIAL MACROSES (STARTS WITH $):
# $@ name of target 
# $? list of dependancies before that macro
# $^ list of dependancies which independent of wheather they met before or after
# $+ similar to $^ but doesn't exclude dublicates
# $< first dependancy

# PHONY TARGET ARE TARGETS WITHOUT OUTPUT FILES
.PHONY: depend clean finish

all:  clean $(EXEC_TARGET) finish

$(EXEC_TARGET):$(OBJFILES)
	$(CXX) $(CXXFLAGS) $(INCLUDES) -o $(EXEC_TARGET) $(OBJFILES) $(LIBPATH) $(LIBS)

# These are the suffix replacement rules
%.o : %.c
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

%.o : %.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

clean:
	@ -rm *.o

#remove intermediate obj files
finish:
	@ -rm $(OBJFILES)

depend: $(SRCFILES)
	makedepend $(INCLUDES) $^

# make depend needs this line
# ****************************END OF BUILDING TARGETS SECTION**************************